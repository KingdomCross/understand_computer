第2章 CAN总线网络结构设计及其应用层协议研究
===========================================

网络中各个节点相互联接的方法和形式称为网络拓扑。作为网络上的节点，车辆电子设备具有种类繁多并且信号性质也各不相同的特点。根据节点相互之间的通信关系，确定合适的网络拓扑结构是建立车用网络体系的第一步。合理的网络拓扑结构对于优化网络性能降低网络复杂性、增加可靠性及降低成本是非常重要的。

2.1 前言
--------

CAN总线的全称是控制器局域网，英文全称：Controller Area
Network，它是由德国BOSCH公司自行开发的多主控点的串行数据通讯协议，是当今国际上运用最广泛的标准现场总线之一。随着CAN总线技术的发展，其应用领域目前已不再局限于汽车行业，而是向过程工业、机械工业、纺织机械、农用机械、机器人、数控机床、医疗器材及传感器等领域发展。目前国际上一些发达国家，在农机具上主要采用
CAN 总线来进行各个电子控制单元（Electronic Control
Unit，ECU）间的通信\[2\]。CAN
总线作为农机网络节点连接的标准总线，对传感器、控制部件、执行器、信息存储和显示单元之间的数据传输格式和方法进行了规定，可有效提高农机
各项性能，同时压缩了产品开发周期，降低开发成本\[3-4\]。

1986年，德国\[5\]首先提出了基于CAN2.0A版本的农业机械总线标准（DIN9684），并从1993年起在欧洲各国的农机制造厂商开始普遍采用此标准。美国汽车工业协会于上世纪九十年代初制定了适用于卡车和客车控制与通讯的多元协议，即基于CAN2.0B的卡车和公交车总线标准J1939。考虑到卡车和客车上使用的许多动力部件也可用于农林拖拉机及机具，美国农业工程学会对J1939标准进行了扩充，使其能满足美国农林拖拉机及机具需要。90年代中期以后，国际标准化组织参照DIN9684、SAEJ1939等标准制定了ISO11783，作为正式的农业机组数据通信及其接口设计的国际标准\[5\]。该标准确定用CAN2.0B总线作为多控制器节点之间的网络连接标准总线（称为ISOBUS），规定了传感器、执行器、控制部件以及信息存储和显示单元等之间的数据传输方法和格式。

当今，国外很多科研机构以及大公司都在积极的关注和研究CAN总线，并投入了大量的人力和资金进行研发\[6\]。荷兰的Philips、美国的Intel、Motorola等半导体制造商开发了支持CAN协议的集成器件\[7\]。著名的CAN组织CIA（CAN
in
Automation）一直在负责研究CAN总线规范，推进其新协议的标准化，并不断完善CAN协议，从规范上提高实时性和可靠性。在农机方面，美国的CASE、约翰迪尔，德国的CLAAS、Fendt，日本的久保田（Kubota）、洋马（YANMAR）等公司已开发出很多符合ISO11783标准的产品\[8-10\]，用于农机作业导航、联合收割机、精量播种等作业之中。

国内在农业机械方面，CAN总线应用研究还很少，西北农林大学的杨修波、王民等提出一种基于CAN总线的精密播种机监控系统中的应用，依托周立功开发软件在实验室中能够实时监控播种全过程\[11\]；河南科技大学的张明柱、赵剡水、周志立等对农机总线ISO11783进行研究，为电控农机具通过ISOBUS与拖拉机的连接提供了通用的调整人机界面\[12-13\]；中国科学院沈阳自动化研究所的胡静涛等设计开发了一种基于CAN总线的具有较强通用性的农机自动导航控制系统\[14\]，并安装在雷沃谷神联合收获机上进行了道路试验，验证了设计方案的可行性及系统的可用性，为下一步的提高导航精度研究提供了一个很好的平台；中国农业大学和洛阳拖拉机研究所有限公司的杨为民\[15\]等人也对ISO11783标准进行了研究，其中中国农业大学的谢斌、毛恩荣\[16\]等对拖拉机电液悬挂系统中CAN总线智能节点进行了研究；王琦、李民赞等对谷物联合收割机测产系统进行了基于CAN总线的智能监视器研究\[17\]。国家农业信息化工程技术研究中心的周建军等对基于ISO11783协议的拖拉机导航控制系统进行了研究\[18\]；南京农业大学的鲁植雄，王文伟，袁越阳等，对CAN总线进行研究，并设计了基于CAN总线的拖拉机虚拟仪表系统\[19\]。

2.2 总线节点建模
----------------

网络中各个节点相互联接的方法和形式称为网络拓扑。作为网络上的节点，车辆电子设备具有种类繁多并且信号性质也各不相同的特点。根据节点相互之间的通信关系，确定合适的网络拓扑结构是建立车载网络模型重要的一步。合理的网络拓扑结构对于优化网络性能，降低网络复杂性、增加可靠性及降低成本是非常重要的。车载局域网络有各种各样的拓扑结构，典型的有总线型、环形和星型，如图：

![](media/image1.png){width="5.768055555555556in"
height="1.6243055555555554in"}

智能农机上的网络特点可归纳为通讯距离短、子功能模块化较好、扩充性要求高、网络复杂度要求不高、可靠性要求高等。因此。考虑智能农机网络的特点将这些拓扑结构进行比较,可以看出总线型的结构是最适合车用网络体系的。
